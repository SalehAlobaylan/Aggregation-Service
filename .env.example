# Wahb Aggregation Service - Environment Variables
# Copy this file to .env and fill in the required values.

# Production URL: https://wahb-broker.salehspace.dev
# Note: Port 5000 is reserved for aggregation (not currently implemented)
# Port 5002 is used for metrics/health endpoints

# ============================================================================
# REQUIRED - Core Services
# ============================================================================

# CMS Internal API
# Production: https://cms.salehspace.dev/internal
CMS_BASE_URL=http://localhost:8080/internal
CMS_SERVICE_TOKEN=your-service-token-here

# Redis (BullMQ queue backend)
REDIS_URL=redis://localhost:6379

# Admin JWT verification (CMS-issued HS256 token)
JWT_SECRET=your-shared-jwt-secret

# ============================================================================
# ADMIN AUTH + CORS (Console -> Aggregation)
# ============================================================================

# Expected JWT issuer and audience
ADMIN_JWT_ISSUER=cms-service
ADMIN_JWT_AUDIENCE=platform-console

# Roles allowed to access /admin/* (comma-separated)
ADMIN_ALLOWED_ROLES=admin,manager

# Allowed browser origins for Platform Console (comma-separated)
PLATFORM_CONSOLE_ORIGINS=http://localhost:3005,http://localhost:3000

# ============================================================================
# REQUIRED - Object Storage (S3-compatible)
# ============================================================================

# Storage endpoint (MinIO for local dev, Supabase/S3 for prod)
STORAGE_ENDPOINT=http://localhost:9000
STORAGE_BUCKET=wahb-media
STORAGE_ACCESS_KEY=minioadmin
STORAGE_SECRET_KEY=minioadmin
STORAGE_PUBLIC_URL=http://localhost:9000
STORAGE_REGION=us-east-1

# ============================================================================
# AI SERVICES
# ============================================================================

# Whisper ASR API (transcription)
WHISPER_API_URL=http://localhost:9002

# ============================================================================
# MEDIA PROCESSING
# ============================================================================

# Temp directory for downloads/transcoding
MEDIA_TEMP_DIR=/tmp/wahb-media

# ============================================================================
# WORKER CONFIGURATION
# ============================================================================

# Number of concurrent jobs per worker
WORKER_CONCURRENCY=5

# Queues to process (comma-separated)
QUEUE_NAMES=fetch,normalize,media,ai

# ============================================================================
# LOGGING & OBSERVABILITY
# ============================================================================

# Log level: debug, info, warn, error
LOG_LEVEL=info

# Metrics/health endpoint port (changed from 3001 to 5002)
METRICS_PORT=5002

# ============================================================================
# CIRCUIT BREAKER TUNING
# ============================================================================

# Failures before opening circuit
CB_FAILURE_THRESHOLD=5

# Milliseconds before attempting recovery
CB_RESET_TIMEOUT_MS=30000

# Requests to test in half-open state
CB_HALF_OPEN_REQUESTS=3

# ============================================================================
# RATE LIMITING (per source type)
# ============================================================================

# Default sliding window duration (ms)
RATE_LIMIT_WINDOW_MS=60000

# Per-source max requests per window
RATE_LIMIT_MAX_REQUESTS_RSS=60
RATE_LIMIT_MAX_REQUESTS_YOUTUBE=100
RATE_LIMIT_MAX_REQUESTS_PODCAST=60
RATE_LIMIT_MAX_REQUESTS_REDDIT=60
RATE_LIMIT_MAX_REQUESTS_TWITTER=100
RATE_LIMIT_MAX_REQUESTS_ITUNES=20

# Twitter uses a longer window (scraping mode)
RATE_LIMIT_WINDOW_MS_TWITTER=3600000

# ============================================================================
# OPTIONAL - iTunes Search API (Podcast Discovery)
# ============================================================================

# Enable iTunes Search (default: true)
ENABLE_ITUNES_SEARCH=true

# ============================================================================
# OPTIONAL - Source Allowlist
# ============================================================================

# Path to JSON file with allowed scraping domains
# SOURCE_ALLOWLIST_PATH=/config/allowlist.json

# ============================================================================
# OPTIONAL - YouTube Data API v3
# ============================================================================

# Required for YouTube source fetching
# YOUTUBE_API_KEY=your-youtube-api-key
# YOUTUBE_QUOTA_LIMIT=10000

# ============================================================================
# OPTIONAL - Reddit OAuth
# ============================================================================

# Required for Reddit source fetching
# REDDIT_CLIENT_ID=your-reddit-client-id
# REDDIT_CLIENT_SECRET=your-reddit-client-secret
# REDDIT_USERNAME=your-reddit-username
# REDDIT_PASSWORD=your-reddit-password

# ============================================================================
# OPTIONAL - Twitter/X API
# ============================================================================

# Required for Twitter source fetching
# TWITTER_BEARER_TOKEN=your-twitter-bearer-token
